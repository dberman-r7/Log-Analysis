# Change Request: CR-2026-02-11-003

**Status**: APPROVED

**Created**: 2026-02-11
**Last Updated**: 2026-02-11

---

## Basic Information

**Title**: Add poll iteration count, elapsed time, and response details to Log Search debug logs

**Requestor**: User

**Category**: DOCUMENTATION

**Priority**:
- [ ] P0 - CRITICAL
- [ ] P1 - HIGH
- [x] P2 - MEDIUM
- [ ] P3 - LOW

---

## Description

### Problem Statement
When the Log Search query polling loop runs, it can look stuck. Current logs show the query submission and some polling events, but they donâ€™t consistently include:
- a poll iteration counter
- time elapsed since polling started
- response details at the moment we receive a response

This makes it harder to diagnose slow/stuck queries, rate limiting, and unexpected response shapes.

### Proposed Solution
Enhance structured debug logs in `Rapid7ApiClient._poll_request_to_completion()` to include:
- `poll_count` on each poll
- `elapsed_seconds` since poll start
- response details when a response is received (status code, safe headers, body preview at DEBUG only)
- include these fields on rate-limit and completion events

### Business Justification
Improves triage speed for API issues and prevents silent hangs by making progress and remote responses observable.

---

## Affected Components

- `src/log_ingestion/api_client.py` (polling observability)
- `tests/test_api_client.py` (assert log fields and behavior)
- `docs/requirements/rtm.md` (traceability)

---

## Impact Assessment (Summary)

- **Breaking changes**: NO (logging-only)
- **Security impact**: Low; ensure headers are redacted and body preview is truncated and DEBUG-only.
- **Performance impact**: Low; avoid heavy body logging at INFO.
- **Testing impact**: Add/adjust unit tests to cover new telemetry fields.
- **Documentation impact**: Update RTM requirement mapping to the updated log events/fields.
